(()=>{"use strict";var e,t,n,i,r={684:(e,t,n)=>{function i(e,t){for(var n,i=0;i<t.length;i++)(n=t[i]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}var r=n(4433),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,(n=[{key:"startAuction",value:function(){this.measure=r("UAM:auction")}},{key:"requestBids",value:function(e,t,n){return e.gdprIsApplicable?Promise.resolve(void 0):new Promise((function(t){var i;if(window.apstag?i=n.filter((function(e){return e.mediaTypes.banner})).map((function(e){return{sizes:e.mediaTypes.banner.sizes,slotID:e.code,slotName:e.adUnitPath}})):t(void 0),i&&i.length){var o=setTimeout((function(){t(!1)}),e.timeout),a=r("UAM:fetchBids");window.apstag.fetchBids({slots:i},(function(e){a.end(),clearTimeout(o),t(new s(e))}))}else t(void 0)}))}},{key:"endAuction",value:function(){this.measure.end()}}])&&i(t.prototype,n),e;var t,n}();function s(){this.prepareRequest=function(){window.apstag.setDisplayBids()}}e.exports=o},9206:(e,t,n)=>{function i(e,t){for(var n,i=0;i<t.length;i++)(n=t[i]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}var r=n(7586),o=0,s=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.pbjs=t,this.pbjs.aliasBidder("freewheel-ssp","freewheel"),this.pbjs.aliasBidder("33across","33acrosshi"),this.features=n}return t=e,(n=[{key:"init",value:function(e){var t={bidderSequence:"fixed",enableSendAllBids:!1,ix:{firstPartyData:Object.assign({},e.keyValues)},userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}},syncDelay:5e3},priceGranularity:{buckets:[{precision:2,min:0,max:r.PRICING_BREAKPOINT,increment:.01},{precision:2,min:r.PRICING_BREAKPOINT,max:r.PRICING_MAX_BUCKET,increment:1}]},rubicon:{singleRequest:!0},useBidCache:!0,cache:{url:"https://prebid.adnxs.com/pbc/v1/cache"}};t.consentManagement=e.gdprIsApplicable?{gdpr:{cmpApi:"iab",timeout:1e4,defaultGdprScope:!0,allowAuctionWithoutConsent:!1}}:{usp:{cmpApi:"iab",timeout:1e4}},this.pbjs.setConfig(t),e.pbjsConfig&&this.pbjs.setConfig(e.pbjsConfig);var n=function(){var e;if(window.crypto&&window.crypto.getRandomValues){var t=new Uint32Array(1);window.crypto.getRandomValues(t),e=t[0]/4294967296}else e=Math.random();return Math.floor(e*Math.pow(10,16))};if(this.features.isEnabled("use-hummingbird")&&e.pbjsConfig&&e.hummingbirdUrl){if(!window.hummingbirdCorrelator){var i=n();if(i===n())return;window.hummingbirdCorrelator=i}var o=this.features.isEnabled("verbose-hummingbird");this.pbjs.enableAnalytics({provider:"maven",options:{contentItemId:"tm-"+e.pbjsConfig.contentItemId,countryCode:e.pbjsConfig.countryCode,mavenChannel:e.pbjsConfig.mavenChannel,pod:e.keyValues.pod,productionDomain:e.pbjsConfig.productionDomain,screenSize:e.screenSize,url:e.hummingbirdUrl,verbose:o,zoneMap:e.pbjsConfig.zoneMap}})}!this.features.isEnabled("disable-li")&&e.pbjsConfig&&this.pbjs.enableAnalytics({provider:"mavenDistributionAnalyticsAdapter",options:{zoneMap:e.pbjsConfig.zoneMap}})}},{key:"startAuction",value:function(e){var t=this;this._initialized||(this.init(e),this._initialized=!0),this.bidConfigByAdUnit={},Object.keys(e.unitVendorConfig||{}).forEach((function(n){t.bidConfigByAdUnit[n]=e.unitVendorConfig[n]})),this.pbjs.bidderSettings={trustx:{bidCpmAdjustment:function(e,n){var i=t.bidConfigByAdUnit[n.adUnitCode];return i&&i.trustx&&i.trustx.bidReductionPercent&&(e*=1-i.trustx.bidReductionPercent/100),e}}},e.gdprIsApplicable&&this.pbjs.setConfig({userSync:{syncEnabled:!1}})}},{key:"requestBids",value:function(e,t,n){var i,r=this;return t||(i=++o),n.forEach((function(t){for(var n in t.bids.forEach((function(t){Object.keys(e.keyValues).forEach((function(n){var i=e.keyValues[n],r=Array.isArray(i);if(r||(i=""+i),"rubicon"===t.bidder)(t.params.inventory||(t.params.inventory={}))[n]=r?i:[i];else if("pubmatic"!==t.bidder||r)"appnexus"===t.bidder&&(t.params.keywords||(t.params.keywords={}),"pod"===n&&(i=+i),t.params.keywords[n]=i);else{t.params.dctr?t.params.dctr+="|":t.params.dctr="";var o=function(e){return e.replace(/[=|]/g,"")};n=o(n),i=o(i),t.params.dctr+=n+"="+i}}))})),t.mediaTypes){var i=t.mediaTypes[n];"video"==n&&"outstream"===i.context&&(i.renderer={url:"https://acdn.adnxs.com/video/outstream/ANOutstreamVideo.js",render:function(e){window.ANOutstreamVideo.renderAd({targetId:e.adUnitCode,adResponse:e.adResponse})}})}})),new Promise((function(s,u){var c=function(n){return t||i===o?void s(new a(n,e,r.pbjs)):void u(new Error("auction interrupted"))},d=[];window.IxLibraryPromise&&d.push(window.IxLibraryPromise),window.SublimeRendererPromise&&d.push(window.SublimeRendererPromise),window.IdentityLinkPromise&&d.push(window.IdentityLinkPromise),Promise.all(d).then((function(){window.SublimeRendererPromise&&!window.sublime&&n.forEach((function(e){e.bids=e.bids.filter((function(e){return"sublime"!==e.bidder}))}));var t=e.timeout;window.phxTrackedFeatures["longer-prebid-timeouts"]&&!e.isRefresh&&(t=1500);for(var i=0;i<n.length;i++)for(var o in n[i].mediaTypes){var s=n[i].mediaTypes[o];"video"==o&&"instream"===s.context&&(e.videoTimeout&&(t=e.videoTimeout),window.phxTrackedFeatures["longer-prebid-timeouts"]&&!e.isRefresh&&(t=1750))}r.pbjs.requestBids({timeout:t,adUnits:n,bidsBackHandler:c})}))}))}},{key:"endAuction",value:function(){}}])&&i(t.prototype,n),e;var t,n}();function a(e,t,n){var i=this;this._pbjs=n,this.prepareRequest=function(e){i._pbjs.setTargetingForGPTAsync(e.map((function(e){return e.getSlotElementId()}))),e.forEach((function(e){var t=e.getTargeting("hb_pb");t&&t.length&&e.setTargeting("hb_pbd",r.getCpmDollarBucket(parseFloat(t[0])).toString());var n=e.getTargeting("hb_deal");n&&n.length&&e.setTargeting("deal","1");var o=e.getTargeting("hb_adid"),s=i._highestBid(e.getSlotElementId());s&&o&&o.length&&o[0]===s.adId&&s.appnexus&&s.appnexus.buyerMemberId&&e.setTargeting("apnmid",s.appnexus.buyerMemberId)}))},this.getMaxBidForAdUnit=function(e){var t=i._highestBid(e),n=0;return t&&t.cpm&&(n=t.cpm),n},this._highestBid=function(e){var t=i._pbjs.getHighestCpmBids(e);if(t&&t.length)return t[0]}}e.exports=s},566:(e,t,n)=>{function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t,n=1;n<arguments.length;n++)t=null==arguments[n]?{}:arguments[n],n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}));return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=n(4433),a=new Set(["appnexus","gumgum","ix","openx","pubmatic","rubicon","spotx","teads"]),u=0,c=0;function d(){this.getSlotModelPropertiesForAdUnit=function(){return{}},this.getMaxBidForAdUnit=function(){return 0},this.prepareRequest=function(){}}e.exports=function(e,t,n){var i=this;function o(t,n,i){var r=this;return Promise.all([window.GdprStatus.countryCodeSafe(),window.GdprStatus.isDemonetizedSafe()]).then((function(o){var d=o[0];if(o[1])!0!==n&&r._auctionConfigPromiseResolve(!1);else{!0!==n&&(p=t,r._auctionConfigPromiseResolve(!0)),t.screenSize=e,t.keyValues=r.keyValues;var m=location.pathname.split("/");m[0]=location.hostname;var h="",g=1;m.forEach((function(e){""!==e&&(h+=(""===h?"":"/")+e,t.keyValues["au"+g++]=h)})),t.keyValues.pod=""+c;var b=s("prebid:auction:"+ ++u);t.pbjsConfig||(t.pbjsConfig={}),t.pbjsConfig.countryCode=d;var v={};t.slots&&t.slots.map((function(e){v[e.id]={zone:e.model&&e.model.zone,index:e.model&&e.model.index}})),window.phxPageTarget&&window.phxPageTarget.config.dynamicSlots&&window.phxPageTarget.config.dynamicSlots.map((function(e){v[e.id]={zone:e.model&&e.model.zone,index:e.model&&e.model.index}})),t.pbjsConfig.zoneMap=v,r._services.forEach((function(e){return e.startAuction(t,i)}));var w=t.units[e]||[];t.gdprIsApplicable&&(w=w.filter((function(e){return e.bids=e.bids.filter((function(e){return a.has(e.bidder)})),0<e.bids.length}))),w.forEach((function(e){e.bids=e.bids.filter((function(e){var t=!0;if(e.geographicRestrictions){var n=e.geographicRestrictions.countries||[];"exclude"===e.geographicRestrictions.restrictionType?t=!n.includes(d):"restrictTo"===e.geographicRestrictions.restrictionType&&(t=n.includes(d)),delete e.geographicRestrictions}return t}))}));var y=r._services.map((function(e){return e.requestBids(t,i,w)})),P=Promise.all(y).then((function(e){return b.end(),r._services.forEach((function(n){return n.endAuction(t,i,w,e)})),e}));i?l[i]=P:f=P}}))}if(n)return this.getLatestResult=function(){return Promise.resolve(new d)},this.getResultById=function(){return Promise.resolve(new d)},this.startAuction=function(){},this.rerunAuction=function(){},void(this.addService=function(){});this._services=[];var f,p,l={},m=new Promise((function(e){i._auctionConfigPromiseResolve=e}));0===c&&(c=function(){function e(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}var t,n="pageViews",i=window.localStorage;if(!i)return 0;try{t=JSON.parse(i.getItem(n))}catch(e){}if(t&&t.created){var r=e(new Date(t.created)),o=e(new Date);r.getTime()===o.getTime()?++t.value:(i.removeItem(n),t=void 0)}return t||(t={created:new Date,value:0}),i.setItem(n,JSON.stringify(t)),t.value}());var h=function(e){return{prepareRequest:function(t){e.forEach((function(e){e&&e.prepareRequest&&e.prepareRequest(t)}))},getSlotModelPropertiesForAdUnit:function(t){var n=Object.assign({},i.keyValues);return e.forEach((function(e){e&&e.getSlotModelPropertiesForAdUnit&&Object.assign(n,e.getSlotModelPropertiesForAdUnit(t))})),n},getMaxBidForAdUnit:function(t){var n=0;return e.forEach((function(e){e&&e.getMaxBidForAdUnit&&(n=Math.max(n,e.getMaxBidForAdUnit(t)))})),n}}};this.keyValues={},this.getLatestResult=function(){return f?f.then(h):Promise.resolve(new d)},this.getResultById=function(e){return l.hasOwnProperty(e)?l[e].then(h):Promise.reject(new Error("Unknown auction result requested: "+e))},this.startAuction=function(e){var t=this,n=arguments,i=function(){return o.apply(t,n)},r=window.GdprStatus;return e.gdprIsApplicable&&void 0===e.gdprIsConsentGiven?r.waitForConsentValue().then((function(){r.isConsentGivenForPurposes(r.PURPOSE_IDS.advertising).then((function(t){e.gdprIsConsentGiven=t,i()}))})):i()},this.dynamicAuction=function(t,n){var i=this;return new Promise((function(o,s){m.then((function(a){a||s();var u=r(r({},p),{},{slots:t.slots,unitVendorConfig:t.unitVendorConfig,units:{}});u.units[e]=t.units[e],i.startAuction(u,!0,n).then((function(){o()}))}))}))},this.rerunAuction=function(t,n,i){if(!p)return!1;var r,o=!1;return t?((r={siteProductionDomain:p.siteProductionDomain,timeout:n||p.timeout,isRefresh:!0,slots:p.slots.filter((function(e){return e.id===t})),unitVendorConfig:p.unitVendorConfig,units:{}}).units[e]=p.units[e].filter((function(e){return e.code===t})),o=!0):r=p,this.startAuction(r,o,i),!0},this.addService=function(e){this._services.push(e)},this.setKeyValue=function(e,t){this.keyValues[e]=t}}},7586:e=>{e.exports={PRICING_BREAKPOINT:20,PRICING_MAX_BUCKET:50,getCpmDollarBucket:function(e){return Math.min(Math.floor(e),50)}}},7796:e=>{e.exports=function(e,t){function n(e){t.then?t.then((function(n){t=n,e.call(t)})):e.call(t)}var i=window[e];if(window[e]={push:n},void 0!==i)for(var r=0;r<i.length;r++)n(i[r])}},6483:e=>{var t,n=function(){};try{t=window}catch(e){t={}}e.exports=t.performance&&t.performance.mark?t.performance:{getEntriesByName:n,mark:n,measure:n}},4433:(e,t,n)=>{var i=n(6483),r=0;function o(){var e="phxMark:"+r++;return i.mark(e),e}e.exports=function(e){var t=o();return{end:function(){var n=o();i.measure(e,t,n);var r=i.getEntriesByName(e);if(r&&r.length)return r[r.length-1].duration}}}}},o={};function s(e){if(o[e])return o[e].exports;var t=o[e]={exports:{}};return r[e](t,t.exports,s),t.exports}e=s(7796),t=s(566),n=s(9206),i=s(684),window.phxConfigQueue.push((function(){var r=this,o=window.pbjs;o.que.push((function(){var s=new t(r.breakpoint.get(),r.features,r.user.hasPremium());s.addService(new n(o,r.features)),s.addService(new i),e("phxAdAuctionQueue",s)}))}))})();
//# sourceMappingURL=adAuctionPrebidJSAmazonUAM.min.js.map